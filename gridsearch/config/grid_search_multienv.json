{
  "_meta": {
    "version": "1.0.0",
    "description": "Grid Search Multiambiente — dimensão 'ambiente computacional' acrescida ao espaço de hiperparâmetros para estudo Skyband sob personalização de SLA",
    "author": "Gustavo Alexandre",
    "date": "2026-03-01",
    "hypothesis": "Dada uma personalização de SLA, quais são as melhores configurações em domínio multicriterio usando Skyband para propor um Ambiente Computacional adequado de Pipelines de Aprendizado de Máquina via Consultas Skyband",
    "sla_profiles_path": "gridsearch/config/sla_profiles.json",
    "base_config": "config/experiments/BertPLI.config",
    "total_combinations": {
      "hyperparameters_only": 216,
      "with_environments": 1080,
      "formula": "4 (lr) × 3 (bs) × 2 (opt) × 3 (dropout) × 3 (seed) × 5 (envs) = 1080",
      "note": "Cada combinação hiperparâmetro+ambiente gera um ponto no espaço multicriterio Skyband"
    }
  },

  "hyperparameters": {
    "_comment": "Idêntico ao grid_search.json; otimizadores reduzidos a [adam, adamw] para manter 216 combinações base (4×3×2×3×3)",
    "learning_rate": [1e-5, 2e-5, 3e-5, 5e-5],
    "batch_size": [8, 16, 32],
    "optimizer": ["adam", "adamw"],
    "dropout": [0.1, 0.2, 0.3],
    "seed": [42, 123, 456]
  },

  "environments": {
    "_comment": "Chaves devem corresponder exatamente às chaves de 'environments' em sla_profiles.json",
    "active": ["local", "colab", "gcp", "aws", "azure"],
    "details": {
      "local": {
        "label": "Local RTX 3090",
        "gpu": "NVIDIA RTX 3090",
        "vram_gb": 24,
        "cost_per_hour_usd": 0.04,
        "co2_factor_kg_per_kwh": 0.233,
        "parallel_workers": 2,
        "estimated_time_hours": {
          "per_experiment": 0.5,
          "total_216_experiments": 54.0,
          "note": "Estimativa com parallel=2; depende de batch_size e epochs"
        }
      },
      "colab": {
        "label": "Google Colab T4",
        "gpu": "NVIDIA T4",
        "vram_gb": 16,
        "cost_per_hour_usd": 0.00,
        "co2_factor_kg_per_kwh": 0.082,
        "parallel_workers": 1,
        "estimated_time_hours": {
          "per_experiment": 0.75,
          "total_216_experiments": 162.0,
          "note": "Sessão limitada a ~12h; necessita retomada com --resume"
        }
      },
      "gcp": {
        "label": "GCP n1-standard-4 + T4",
        "gpu": "NVIDIA T4",
        "vram_gb": 16,
        "cost_per_hour_usd": 0.35,
        "co2_factor_kg_per_kwh": 0.082,
        "parallel_workers": 2,
        "estimated_time_hours": {
          "per_experiment": 0.75,
          "total_216_experiments": 81.0,
          "note": "Preço spot reduz custo em ~70%"
        }
      },
      "aws": {
        "label": "AWS g4dn.xlarge (T4)",
        "gpu": "NVIDIA T4",
        "vram_gb": 16,
        "cost_per_hour_usd": 0.526,
        "co2_factor_kg_per_kwh": 0.385,
        "parallel_workers": 2,
        "estimated_time_hours": {
          "per_experiment": 0.75,
          "total_216_experiments": 81.0,
          "note": "Instância Spot reduz custo em ~60%"
        }
      },
      "azure": {
        "label": "Azure NC6s v3 (V100 16GB)",
        "gpu": "NVIDIA V100",
        "vram_gb": 16,
        "cost_per_hour_usd": 0.90,
        "co2_factor_kg_per_kwh": 0.190,
        "parallel_workers": 2,
        "estimated_time_hours": {
          "per_experiment": 0.50,
          "total_216_experiments": 54.0,
          "note": "V100 mais rápido que T4 para batch_size=32; Spot ~60% mais barato"
        }
      }
    }
  },

  "experiment_matrix": {
    "_comment": "Define como o produto cartesiano hiperparâmetros × ambientes é gerado",
    "mode": "cross_product",
    "description": "Para cada ambiente ativo, executa os 216 experimentos do grid. O campo 'environment' é adicionado a cada resultado como dimensão extra para análise Skyband.",
    "output_structure": {
      "result_fields": [
        "grid_experiment_idx",
        "grid_params",
        "environment",
        "status",
        "resources"
      ],
      "resources_fields": [
        "train_time_sec",
        "energy_kwh",
        "peak_ram_mb",
        "total_gflops",
        "emissions_kg_co2",
        "cost_usd"
      ],
      "cost_formula": "cost_usd = (train_time_sec / 3600) × environment.cost_per_hour_usd",
      "co2_formula":  "emissions_kg_co2 = energy_kwh × environment.co2_factor_kg_per_kwh"
    }
  },

  "skyband": {
    "_comment": "Parâmetros para análise Skyband aplicada sobre os 1080 pontos experimentais",
    "default_metrics": [
      "train_time_sec",
      "energy_kwh",
      "total_gflops",
      "emissions_kg_co2",
      "cost_usd"
    ],
    "default_minimize": [true, true, true, true, true],
    "analysis_k_values": [1, 2, 3, 5, 10],
    "sla_profiles_path": "gridsearch/config/sla_profiles.json",
    "research_questions": {
      "Q1": {
        "question": "Qual ambiente domina o Skyline do critério custo × tempo?",
        "method": "skyband_query(k=1, metrics=['cost_usd','train_time_sec'])"
      },
      "Q2": {
        "question": "O Skyband k=3 com SLA 'economico' coincide com o melhor por ranking escalar?",
        "method": "compare_skyband_vs_ranking(sla=profiles['economico']['constraints'], k=3)"
      },
      "Q3": {
        "question": "Quanto o perfil de SLA altera o conjunto de recomendação?",
        "method": "Jaccard entre Skyband_k para cada par de perfis SLA"
      },
      "Q4": {
        "question": "Existe correlação entre batch_size e posição no Skyband?",
        "method": "Pearson(batch_size, domination_count)"
      },
      "Q5": {
        "question": "Para qual k o Skyband converge para uma recomendação estável?",
        "method": "Curva |Skyband_k| × k para cada perfil de SLA"
      }
    }
  },

  "execution": {
    "sequential": {
      "command": "python -m gridsearch.core --config config/experiments/BertPLI.config --search-config gridsearch/config/grid_search_multienv.json --parallel 1",
      "note": "Modo sequencial; adequado para depuração e ambientes sem GPU extra"
    },
    "parallel": {
      "command": "python -m gridsearch.core --config config/experiments/BertPLI.config --search-config gridsearch/config/grid_search_multienv.json --parallel 2",
      "note": "Modo paralelo recomendado; ajuste --parallel conforme GPUs disponíveis"
    },
    "resume": {
      "command": "python -m gridsearch.core --resume --search-config gridsearch/config/grid_search_multienv.json --parallel 2",
      "note": "Retoma execução interrompida; estado salvo em output/experiments/grid_search/"
    },
    "analyze": {
      "command": "python -m gridsearch.analysis --results-file output/experiments/grid_search/grid_search_results.json",
      "note": "Análise descritiva clássica; use skyband_query() para análise Skyband"
    },
    "recommendations": {
      "min_ram_gb": 16,
      "safe_ram_gb": 32,
      "note_per_env": {
        "local": "parallel=2 seguro com 32GB RAM; parallel=4 requer 64GB",
        "colab":  "parallel=1 obrigatório; sessão de ~12h → use --resume",
        "gcp":    "parallel=2 recomendado; considere preemptible VMs",
        "aws":    "parallel=2 recomendado; considere Spot Instances",
        "azure":  "parallel=2 recomendado; considere Spot VMs"
      }
    },
    "estimated_total_cost_usd": {
      "local":  8.64,
      "colab":  0.00,
      "gcp":   28.35,
      "aws":   42.61,
      "azure": 48.60,
      "note": "Estimativas on-demand para 216 experimentos de ~30min cada; Spot/Preemptible reduz em ~60-70%"
    }
  }
}
